<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Service Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Пробег -->
        <div id="mileageDisplay" class="mileage-block">
            <span id="currentMileage">0 км</span>
            <img src="assets/edit.svg" class="edit-icon" alt="Редактировать" width="24" height="24">
        </div>

        <!-- Статус ТО -->
        <div id="maintenanceStatus" class="status-block" onclick="openStatusModal()">
            Загрузка...
        </div>

        <!-- Табы -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('records')">Записи</button>
                <button class="tab-btn" onclick="switchTab('items')">Расходники</button>
            </div>
        </div>

        <!-- Контент табов -->
        <div id="recordsTab" class="tab-content active">
            <ul id="maintenanceList" class="maintenance-list"></ul>
        </div>

        <div id="itemsTab" class="tab-content">
            <div class="items-grid">
                <!-- Карточки расходников будут добавляться через JavaScript -->
            </div>
        </div>

        <!-- Кнопка добавления обслуживания -->
        <button id="addMaintenanceBtn" onclick="startMaintenanceFlow()">Добавить обслуживание</button>
    </div>

    <!-- Модалка редактирования пробега -->
    <div id="mileageModal" class="modal bottom-sheet">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Редактировать пробег</h3>
                <button class="close-btn" onclick="closeMileageModal()">✕</button>
            </div>
            <input type="number" id="mileageInputModal" placeholder="0" />
            <div class="modal-buttons">
                <button onclick="saveMileageModal()">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Многошаговое добавление обслуживания -->
    <div id="maintenanceFlowModal" class="modal bottom-sheet">
        <div class="modal-content">
            <!-- Шаг 1: Дата и пробег -->
            <div id="step1" class="flow-step">
                <div class="modal-header">
                    <h3>Когда было обслуживание?</h3>
                    <button class="close-btn" onclick="closeMaintenanceFlow()">✕</button>
                </div>
                <div class="form-group">
                    <label>Дата обслуживания</label>
                    <input type="date" id="serviceDate" style="width:100%;padding:0.8rem;margin:0;border-radius:8px;border:1px solid #ddd;background:#fafafa;color:#333;box-sizing:border-box;font-family:'Nunito',sans-serif;font-size:16px;" />
                </div>
                <input type="number" id="serviceMileage" placeholder="0" style="width:calc(100% - 3rem);margin:0 1.5rem;padding:0.8rem;border-radius:8px;border:1px solid #ddd;background:#fafafa;color:#333;box-sizing:border-box;font-family:'Nunito',sans-serif;font-size:16px;" />
                <div class="modal-buttons">
                    <button onclick="nextStep()">Далее</button>
                </div>
            </div>

            <!-- Шаг 2: Расходники -->
            <div id="step2" class="flow-step" style="display: none;">
                <div class="modal-header">
                    <h3>Какие расходники меняли?</h3>
                    <button class="close-btn" onclick="closeMaintenanceFlow()">✕</button>
                </div>
                <div class="form-group">
                    <div class="items-list">
                        <label><input type="checkbox" name="items" value="Замена масла"> Замена масла</label>
                        <label><input type="checkbox" name="items" value="Воздушный фильтр"> Воздушный фильтр</label>
                        <label><input type="checkbox" name="items" value="Тормозные колодки"> Тормозные колодки</label>
                        <label><input type="checkbox" name="items" value="Свечи зажигания"> Свечи зажигания</label>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button onclick="prevStep()">Назад</button>
                    <button onclick="nextStep()">Далее</button>
                </div>
            </div>

            <!-- Шаг 3: Дополнительные работы -->
            <div id="step3" class="flow-step" style="display: none;">
                <div class="modal-header">
                    <h3>Дополнительные работы</h3>
                    <button class="close-btn" onclick="closeMaintenanceFlow()">✕</button>
                </div>
                <div class="form-group">
                    <label>Примечания о дополнительных работах</label>
                    <textarea id="serviceNotes" placeholder="Опишите дополнительные работы, если были..."></textarea>
                </div>
                <div class="modal-buttons">
                    <button onclick="prevStep()">Назад</button>
                    <button onclick="saveMaintenance()">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модалка просмотра обслуживания -->
    <div id="maintenanceViewModal" class="modal bottom-sheet">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Детали обслуживания</h3>
                <button class="close-btn" onclick="closeViewModal()">✕</button>
            </div>
            <div id="maintenanceDetails"></div>
        </div>
    </div>

    <!-- Модалка статуса ТО -->
    <div id="statusModal" class="modal bottom-sheet">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Статус ТО</h3>
                <button class="close-btn" onclick="closeStatusModal()">✕</button>
            </div>
            <div id="statusList"></div>
        </div>
    </div>

    <!-- Модалка редактирования расходника -->
    <div id="itemEditModal" class="modal bottom-sheet">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Редактировать расходник</h3>
                <button class="close-btn" onclick="closeItemEditModal()">✕</button>
            </div>
            <div class="form-group">
                <label>Интервал замены (км)</label>
                <input type="number" id="itemInterval" placeholder="10000" />
            </div>
            <div class="form-group">
                <label>Заметка о расходнике</label>
                <textarea id="itemNotes" placeholder="Например: Castrol Edge 5W-40"></textarea>
            </div>
            <div class="modal-buttons">
                <button onclick="saveItemEdit()">Сохранить</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Регистрация Service Worker для PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }
    </script>
</body>
</html>